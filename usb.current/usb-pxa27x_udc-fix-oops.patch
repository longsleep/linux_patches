From karl.beldan@gmail.com  Fri May 16 12:21:28 2008
From: "karl beldan" <karl.beldan@gmail.com>
Date: Fri, 16 May 2008 11:30:22 +0200
Subject: USB: pxa27x_udc - Fix Oops
To: linux-usb@vger.kernel.org
Cc: rjarzmik@free.fr
Message-ID: <ea2442770805160230x458b3ac9s8d717449d513fb52@mail.gmail.com>
Content-Disposition: inline


udc_disable oopses dereferencing udc_command.

Signed-off-by: Karl Beldan <karl.beldan@gmail.com>
Acked-by: Robert Jarzmik <rjarzmik@free.fr>
Acked-by: David Brownell <dbrownell@users.sourceforge.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/gadget/pxa27x_udc.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/drivers/usb/gadget/pxa27x_udc.c
+++ b/drivers/usb/gadget/pxa27x_udc.c
@@ -1526,7 +1526,8 @@ static void udc_disable(struct pxa_udc *
 
 	ep0_idle(udc);
 	udc->gadget.speed = USB_SPEED_UNKNOWN;
-	udc->mach->udc_command(PXA2XX_UDC_CMD_DISCONNECT);
+	if (udc->mach->udc_command)
+		udc->mach->udc_command(PXA2XX_UDC_CMD_DISCONNECT);
 }
 
 /**

From oliver@neukum.org  Tue Apr  7 11:12:23 2009
From: Oliver Neukum <oliver@neukum.org>
Date: Sat, 4 Apr 2009 09:25:15 +0200
Subject: USB: fix oops in cdc-wdm in case of malformed descriptors
To: greg@kroah.com, Chuck Ebbert <cebbert@redhat.com>
Message-ID: <200904040925.23539.oliver@neukum.org>
Content-Disposition: inline


cdc-wdm needs to ignore extremely malformed descriptors.

Signed-off-by: Oliver Neukum <oliver@neukum.org>
Cc: stable <stable@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>


---
 drivers/usb/class/cdc-wdm.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/usb/class/cdc-wdm.c
+++ b/drivers/usb/class/cdc-wdm.c
@@ -652,7 +652,7 @@ next_desc:
 
 	iface = &intf->altsetting[0];
 	ep = &iface->endpoint[0].desc;
-	if (!usb_endpoint_is_int_in(ep)) {
+	if (!ep || !usb_endpoint_is_int_in(ep)) {
 		rv = -EINVAL;
 		goto err;
 	}

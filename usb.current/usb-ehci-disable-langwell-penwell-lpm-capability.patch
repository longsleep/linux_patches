From alan@linux.intel.com  Tue Sep  7 00:49:05 2010
From: Alek Du <alek.du@intel.com>
Date: Mon, 06 Sep 2010 14:50:57 +0100
Subject: USB: EHCI: Disable langwell/penwell LPM capability
To: linux-usb@vger.kernel.org
Message-ID: <20100906135040.4591.72919.stgit@localhost.localdomain>


From: Alek Du <alek.du@intel.com>

We have to do so due to HW limitation.

Signed-off-by: Alek Du <alek.du@intel.com>
Signed-off-by: Alan Cox <alan@linux.intel.com>
Cc: stable <stable@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>


---
 drivers/usb/host/ehci-pci.c |    5 +++++
 1 file changed, 5 insertions(+)

--- a/drivers/usb/host/ehci-pci.c
+++ b/drivers/usb/host/ehci-pci.c
@@ -119,6 +119,11 @@ static int ehci_pci_setup(struct usb_hcd
 			ehci->broken_periodic = 1;
 			ehci_info(ehci, "using broken periodic workaround\n");
 		}
+		if (pdev->device == 0x0806 || pdev->device == 0x0811
+				|| pdev->device == 0x0829) {
+			ehci_info(ehci, "disable lpm for langwell/penwell\n");
+			ehci->has_lpm = 0;
+		}
 		break;
 	case PCI_VENDOR_ID_TDI:
 		if (pdev->device == PCI_DEVICE_ID_TDI_EHCI) {

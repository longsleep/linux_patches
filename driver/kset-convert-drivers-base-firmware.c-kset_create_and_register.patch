From foo@baz Tue Apr  9 12:12:43 2002
Date: Mon, 29 Oct 2007 23:22:26 -0500
To: Greg KH <greg@kroah.com>
From: Greg Kroah-Hartman <gregkh@suse.de>
Subject: kset: convert drivers/base/firmware.c kset_create_and_register

Dynamically create the kset instead of declaring it statically.

Cc: Kay Sievers <kay.sievers@vrfy.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/base/firmware.c |   10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

--- a/drivers/base/firmware.c
+++ b/drivers/base/firmware.c
@@ -11,15 +11,16 @@
 #include <linux/kobject.h>
 #include <linux/module.h>
 #include <linux/init.h>
+#include <linux/err.h>
 #include <linux/device.h>
 
 #include "base.h"
 
-static decl_subsys(firmware, NULL);
+static struct kset *firmware_kset;
 
 int firmware_register(struct kset *s)
 {
-	s->kobj.kset = &firmware_subsys;
+	s->kobj.kset = firmware_kset;
 	s->kobj.ktype = NULL;
 	return subsystem_register(s);
 }
@@ -31,7 +32,10 @@ void firmware_unregister(struct kset *s)
 
 int __init firmware_init(void)
 {
-	return subsystem_register(&firmware_subsys);
+	firmware_kset = kset_create_and_register("firmware", NULL, NULL);
+	if (IS_ERR(firmware_kset))
+		return PTR_ERR(firmware_kset);
+	return 0;
 }
 
 EXPORT_SYMBOL_GPL(firmware_register);

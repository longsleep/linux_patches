From jacmet@sunsite.dk  Wed Feb 17 12:37:09 2010
From: Peter Korsgaard <jacmet@sunsite.dk>
Date: Thu,  4 Feb 2010 17:15:25 +0100
Subject: USB: f_mass_storage: fix crash on bind() error
To: m.nazarewicz@samsung.com, gregkh@suse.de, linux-usb@vger.kernel.org
Cc: Peter Korsgaard <jacmet@sunsite.dk>
Message-ID: <1265300125-22037-1-git-send-email-jacmet@sunsite.dk>


init_completion() hasn't been called yet and the thread isn't created
if we end up here, so don't call complete() on thread_notifier.

Signed-off-by: Peter Korsgaard <jacmet@sunsite.dk>
Acked-by: Michal Nazarewicz <m.nazarewicz@samsung.com>
Cc: stable <stable@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/gadget/f_mass_storage.c |    1 -
 1 file changed, 1 deletion(-)

--- a/drivers/usb/gadget/f_mass_storage.c
+++ b/drivers/usb/gadget/f_mass_storage.c
@@ -2865,7 +2865,6 @@ error_release:
 	/* Call fsg_common_release() directly, ref might be not
 	 * initialised */
 	fsg_common_release(&common->ref);
-	complete(&common->thread_notifier);
 	return ERR_PTR(rc);
 }
 

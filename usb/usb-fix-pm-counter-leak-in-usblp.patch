From oliver@neukum.org  Tue Feb 19 10:27:11 2008
From: Oliver Neukum <oliver@neukum.org>
Date: Tue, 12 Feb 2008 19:08:30 +0100
Subject: USB: fix pm counter leak in usblp
To: Pete Zaitcev <zaitcev@redhat.com>, Greg KH <greg@kroah.com>, linux-usb@vger.kernel.org
Message-ID: <200802121908.30655.oliver@neukum.org>
Content-Disposition: inline


if you fail in open() you must decrement the pm counter again.

Signed-off-by: Oliver Neukum <oneukum@suse.de>
Cc: stable <stable@kernel.org>
Signed-off-by: Pete Zaitcev <zaitcev@redhat.com>

---
 drivers/usb/class/usblp.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/usb/class/usblp.c
+++ b/drivers/usb/class/usblp.c
@@ -428,6 +428,7 @@ static int usblp_open(struct inode *inod
 	usblp->rcomplete = 0;
 
 	if (handle_bidir(usblp) < 0) {
+		usb_autopm_put_interface(intf);
 		usblp->used = 0;
 		file->private_data = NULL;
 		retval = -EIO;

From roel.kluin@gmail.com  Tue Aug 25 22:52:03 2009
From: Roel Kluin <roel.kluin@gmail.com>
Date: Mon, 24 Aug 2009 18:27:23 +0200
Subject: USB: gadget: double free_irq() in at91udc_probe()
To: David Brownell <dbrownell@users.sourceforge.net>, linux-usb@vger.kernel.org, Andrew Morton <akpm@linux-foundation.org>
Message-ID: <4A92BF6B.8090408@gmail.com>


If request_irq() fails, udp_irq is freed twice.

Signed-off-by: Roel Kluin <roel.kluin@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/gadget/at91_udc.c |    1 -
 1 file changed, 1 deletion(-)

--- a/drivers/usb/gadget/at91_udc.c
+++ b/drivers/usb/gadget/at91_udc.c
@@ -1754,7 +1754,6 @@ static int __init at91udc_probe(struct p
 				IRQF_DISABLED, driver_name, udc)) {
 			DBG("request vbus irq %d failed\n",
 					udc->board.vbus_pin);
-			free_irq(udc->udp_irq, udc);
 			retval = -EBUSY;
 			goto fail3;
 		}

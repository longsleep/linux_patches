From oliver@neukum.org  Fri Jan 15 14:52:06 2010
From: Oliver Neukum <oliver@neukum.org>
Date: Wed, 13 Jan 2010 15:31:48 +0100
Subject: USB: Remove BKL from usbdev_open()
To: Greg KH <greg@kroah.com>
Message-ID: <201001131531.48643.oliver@neukum.org>

From: Oliver Neukum <oliver@neukum.org>

Locking had long been changed making BKL redundant.
Simply remove it.

Signed-off-by: Oliver Neukum <oliver@neukum.org>
Cc: Alan Stern <stern@rowland.harvard.edu>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/core/devio.c |    4 ----
 1 file changed, 4 deletions(-)

--- a/drivers/usb/core/devio.c
+++ b/drivers/usb/core/devio.c
@@ -653,8 +653,6 @@ static int usbdev_open(struct inode *ino
 	const struct cred *cred = current_cred();
 	int ret;
 
-	lock_kernel();
-
 	ret = -ENOMEM;
 	ps = kmalloc(sizeof(struct dev_state), GFP_KERNEL);
 	if (!ps)
@@ -713,7 +711,6 @@ static int usbdev_open(struct inode *ino
 	usb_unlock_device(dev);
 	snoop(&dev->dev, "opened by process %d: %s\n", task_pid_nr(current),
 			current->comm);
-	unlock_kernel();
 	return ret;
 
  out_unlock_device:
@@ -721,7 +718,6 @@ static int usbdev_open(struct inode *ino
 	usb_put_dev(dev);
  out_free_ps:
 	kfree(ps);
-	unlock_kernel();
 	return ret;
 }
 

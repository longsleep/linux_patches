From jhovold@gmail.com  Tue May 11 16:29:49 2010
From: Johan Hovold <jhovold@gmail.com>
Date: Sat,  8 May 2010 15:18:41 +0200
Subject: USB: pl2303: use tty_insert_flip_string_fixed_flag
To: Greg KH <greg@kroah.com>
Cc: linux-usb@vger.kernel.org, Johan Hovold <jhovold@gmail.com>
Message-ID: <1273324721-2080-1-git-send-email-jhovold@gmail.com>


Use tty_insert_flip_string_fixed_flag to report errors to line
discipline.

Signed-off-by: Johan Hovold <jhovold@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/serial/pl2303.c |    7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

--- a/drivers/usb/serial/pl2303.c
+++ b/drivers/usb/serial/pl2303.c
@@ -786,12 +786,13 @@ static void pl2303_process_read_urb(stru
 	if (line_status & UART_OVERRUN_ERROR)
 		tty_insert_flip_char(tty, 0, TTY_OVERRUN);
 
-	if (tty_flag == TTY_NORMAL && !(port->port.console && port->sysrq))
-		tty_insert_flip_string(tty, data, urb->actual_length);
-	else {
+	if (port->port.console && port->sysrq) {
 		for (i = 0; i < urb->actual_length; ++i)
 			if (!usb_serial_handle_sysrq_char(tty, port, data[i]))
 				tty_insert_flip_char(tty, data[i], tty_flag);
+	} else {
+		tty_insert_flip_string_fixed_flag(tty, data, tty_flag,
+							urb->actual_length);
 	}
 
 	tty_flip_buffer_push(tty);

From jhovold@gmail.com  Thu May 20 10:57:39 2010
From: Johan Hovold <jhovold@gmail.com>
Date: Wed, 19 May 2010 00:01:34 +0200
Subject: USB: ir-usb: fix incorrect write-buffer length
To: Greg Kroah-Hartman <gregkh@suse.de>
Cc: linux-usb@vger.kernel.org, Johan Hovold <jhovold@gmail.com>
Message-ID: <1274220101-13873-6-git-send-email-jhovold@gmail.com>


Returned length should include header length.

Signed-off-by: Johan Hovold <jhovold@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
---
 drivers/usb/serial/ir-usb.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/drivers/usb/serial/ir-usb.c
+++ b/drivers/usb/serial/ir-usb.c
@@ -307,6 +307,7 @@ static int ir_prepare_write_buffer(struc
 						void *dest, size_t size)
 {
 	unsigned char *buf = dest;
+	int count;
 
 	/*
 	 * The first byte of the packet we send to the device contains an
@@ -317,8 +318,9 @@ static int ir_prepare_write_buffer(struc
 	 */
 	*buf = ir_xbof | ir_baud;
 
-	return kfifo_out_locked(&port->write_fifo, buf + 1, size - 1,
+	count = kfifo_out_locked(&port->write_fifo, buf + 1, size - 1,
 								&port->lock);
+	return count + 1;
 }
 
 static void ir_process_read_urb(struct urb *urb)

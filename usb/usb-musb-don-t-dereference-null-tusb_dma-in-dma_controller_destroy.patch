From roel.kluin@gmail.com  Fri Jan 15 13:42:10 2010
From: Roel Kluin <roel.kluin@gmail.com>
Date: Sat, 09 Jan 2010 21:57:44 +0100
Subject: USB: musb: don't dereference NULL tusb_dma in dma_controller_destroy()
To: Felipe Balbi <felipe.balbi@nokia.com>
Message-ID: <4B48EDC8.1000006@gmail.com>


Test whether tusb_dma is not NULL before dereferencing

Signed-off-by: Roel Kluin <roel.kluin@gmail.com>
Cc: Felipe Balbi <felipe.balbi@nokia.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/musb/tusb6010_omap.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/usb/musb/tusb6010_omap.c
+++ b/drivers/usb/musb/tusb6010_omap.c
@@ -648,7 +648,7 @@ void dma_controller_destroy(struct dma_c
 		}
 	}
 
-	if (!tusb_dma->multichannel && tusb_dma && tusb_dma->ch >= 0)
+	if (tusb_dma && !tusb_dma->multichannel && tusb_dma->ch >= 0)
 		omap_free_dma(tusb_dma->ch);
 
 	kfree(tusb_dma);

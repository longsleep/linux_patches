From abogani@texware.it  Mon Mar 15 16:16:01 2010
From: Alessio Igor Bogani <abogani@texware.it>
Date: Mon,  1 Mar 2010 14:10:56 +0100
Subject: USB: sisusbvga: Remove the BKL from ioctl
To: Greg Kroah-Hartman <gregkh@suse.de>, Thomas Winischhofer <thomas@winischhofer.net>, Pete Zaitcev <zaitcev@redhat.com>, Tanaka Akira <akr@fsij.org>
Cc: Alessio Igor Bogani <abogani@texware.it>
Message-ID: <1267449056-30274-1-git-send-email-abogani@texware.it>


Seems to me that BKL is not needed here because necessary locking is already
provided by mutex sisusb->lock.

Also change the returned value to long.

Signed-off-by: Alessio Igor Bogani <abogani@texware.it>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/misc/sisusbvga/sisusb.c |    4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

--- a/drivers/usb/misc/sisusbvga/sisusb.c
+++ b/drivers/usb/misc/sisusbvga/sisusb.c
@@ -2974,13 +2974,12 @@ sisusb_ioctl(struct file *file, unsigned
 	struct sisusb_usb_data *sisusb;
 	struct sisusb_info x;
 	struct sisusb_command y;
-	int	retval = 0;
+	long retval = 0;
 	u32 __user *argp = (u32 __user *)arg;
 
 	if (!(sisusb = (struct sisusb_usb_data *)file->private_data))
 		return -ENODEV;
 
-	lock_kernel();
 	mutex_lock(&sisusb->lock);
 
 	/* Sanity check */
@@ -3039,7 +3038,6 @@ sisusb_ioctl(struct file *file, unsigned
 
 err_out:
 	mutex_unlock(&sisusb->lock);
-	unlock_kernel();
 	return retval;
 }
 

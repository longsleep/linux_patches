From alan@linux.intel.com  Thu Aug 27 14:31:29 2009
From: Alan Cox <alan@linux.intel.com>
Date: Thu, 27 Aug 2009 11:02:43 +0100
Subject: Staging: et131x: kill the loopback type
To: greg@kroah.com
Message-ID: <20090827100239.23892.86206.stgit@localhost.localdomain>


Kill off the loopback type in the driver

Signed-off-by: Alan Cox <alan@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
---

 drivers/staging/et131x/et1310_address_map.h |   22 +++++-----------------
 drivers/staging/et131x/et131x_initpci.c     |    4 ++--
 2 files changed, 7 insertions(+), 19 deletions(-)


--- a/drivers/staging/et131x/et1310_address_map.h
+++ b/drivers/staging/et131x/et1310_address_map.h
@@ -139,23 +139,11 @@
 #define ET_MSI_TC	0x00070000
 
 /*
- * structure for Loopback reg in global address map
- * located at address 0x0034
+ * Loopback reg located at address 0x0034
  */
-typedef union _LOOPBACK_t {
-	u32 value;
-	struct {
-#ifdef _BIT_FIELDS_HTOL
-		u32 unused:30;		/* bits 2-31 */
-		u32 dma_loopback:1;	/* bit 1 */
-		u32 mac_loopback:1;	/* bit 0 */
-#else
-		u32 mac_loopback:1;	/* bit 0 */
-		u32 dma_loopback:1;	/* bit 1 */
-		u32 unused:30;		/* bits 2-31 */
-#endif
-	} bits;
-} LOOPBACK_t, *PLOOPBACK_t;
+
+#define ET_LOOP_MAC	0x00000001
+#define ET_LOOP_DMA	0x00000002
 
 /*
  * GLOBAL Module of JAGCore Address Mapping
@@ -175,7 +163,7 @@ typedef struct _GLOBAL_t {			/* Location
 	u32 sw_reset;				/*  0x0028 */
 	u32 slv_timer;				/*  0x002C */
 	u32 msi_config;				/*  0x0030 */
-	LOOPBACK_t loopback;			/*  0x0034 */
+	u32 loopback;			/*  0x0034 */
 	u32 watchdog_timer;			/*  0x0038 */
 } GLOBAL_t, *PGLOBAL_t;
 
--- a/drivers/staging/et131x/et131x_initpci.c
+++ b/drivers/staging/et131x/et131x_initpci.c
@@ -573,7 +573,7 @@ void ConfigGlobalRegs(struct et131x_adap
 		}
 
 		/* Initialize the loopback register. Disable all loopbacks. */
-		writel(0, &regs->loopback.value);
+		writel(0, &regs->loopback);
 	} else {
 		/* For PHY Line loopback, the memory is configured as if Tx
 		 * and Rx both have all the memory.  This is because the
@@ -586,7 +586,7 @@ void ConfigGlobalRegs(struct et131x_adap
 		writel(INTERNAL_MEM_SIZE - 1, &regs->txq_end_addr);
 
 		/* Initialize the loopback register (MAC loopback). */
-		writel(1, &regs->loopback);
+		writel(ET_LOOP_MAC, &regs->loopback);
 	}
 
 	/* MSI Register */

From vliaskov@gmail.com  Thu Oct  8 15:57:51 2009
From: Vasilis Liaskovitis <vliaskov@gmail.com>
Date: Tue, 22 Sep 2009 01:11:56 -0500
Subject: Staging: b3dfg: remove check for pci bus master
To: devel@linuxdriverproject.org, gregkh@suse.de, jsbronder@brontes3d.com
Message-ID: <20090922061156.GB4827@shadow>
Content-Disposition: inline


Remove unneccesary check for pci master in enable_transmission()

Signed-off-by: Vasilis Liaskovitis <vliaskov@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/staging/b3dfg/b3dfg.c |   12 ------------
 1 file changed, 12 deletions(-)

--- a/drivers/staging/b3dfg/b3dfg.c
+++ b/drivers/staging/b3dfg/b3dfg.c
@@ -468,7 +468,6 @@ static int get_wand_status(struct b3dfg_
 
 static int enable_transmission(struct b3dfg_dev *fgdev)
 {
-	u16 command;
 	unsigned long flags;
 	struct device *dev = &fgdev->pdev->dev;
 
@@ -480,17 +479,6 @@ static int enable_transmission(struct b3
 		return -EINVAL;
 	}
 
-	/*
-	 * Check we're a bus master.
-	 * TODO: I think we can remove this having added the pci_set_master call
-	 */
-	pci_read_config_word(fgdev->pdev, PCI_COMMAND, &command);
-	if (!(command & PCI_COMMAND_MASTER)) {
-		dev_err(dev, "not a bus master, force-enabling\n");
-		pci_write_config_word(fgdev->pdev, PCI_COMMAND,
-			command | PCI_COMMAND_MASTER);
-	}
-
 	spin_lock_irqsave(&fgdev->buffer_lock, flags);
 
 	/* Handle racing enable_transmission calls. */

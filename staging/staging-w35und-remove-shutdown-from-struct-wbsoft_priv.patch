From penberg@cs.helsinki.fi  Wed Nov 12 13:53:54 2008
From: Pekka Enberg <penberg@cs.helsinki.fi>
Date: Thu, 30 Oct 2008 18:12:07 +0200
Subject: Staging: w35und: remove ->shutdown from struct wbsoft_priv
To: greg@kroah.com
Cc: Pekka Enberg <penberg@cs.helsinki.fi>, Pavel Machek <pavel@suse.cz>
Message-ID: <1225383127-16406-7-git-send-email-penberg@cs.helsinki.fi>


It's not actually used for anything, so remove it.

Acked-by: Pavel Machek <pavel@suse.cz>
Signed-off-by: Pekka Enberg <penberg@cs.helsinki.fi>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/staging/winbond/Makefile    |    1 -
 drivers/staging/winbond/core.h      |    1 -
 drivers/staging/winbond/wbhal.c     |    1 -
 drivers/staging/winbond/wblinux.c   |   31 -------------------------------
 drivers/staging/winbond/wblinux_f.h |    2 --
 drivers/staging/winbond/wbusb.c     |    6 +-----
 6 files changed, 1 insertion(+), 41 deletions(-)

--- a/drivers/staging/winbond/core.h
+++ b/drivers/staging/winbond/core.h
@@ -24,7 +24,6 @@ struct wbsoft_priv {
 	MDS Mds;
 
 	spinlock_t SpinLock;
-	u32 shutdown;
 
 	atomic_t ThreadCount;
 
--- a/drivers/staging/winbond/Makefile
+++ b/drivers/staging/winbond/Makefile
@@ -9,7 +9,6 @@ w35und-objs :=			\
 	wb35rx.o		\
 	wb35tx.o		\
 	wbhal.o			\
-	wblinux.o		\
 	wbusb.o			\
 
 
--- a/drivers/staging/winbond/wbhal.c
+++ b/drivers/staging/winbond/wbhal.c
@@ -850,7 +850,6 @@ void hal_surprise_remove(struct wbsoft_p
 		#ifdef _PE_STATE_DUMP_
 		WBDEBUG(("Calling hal_surprise_remove\n"));
 		#endif
-		WBLINUX_stop( adapter );
 	}
 }
 
--- a/drivers/staging/winbond/wblinux.c
+++ /dev/null
@@ -1,31 +0,0 @@
-//============================================================================
-//  Copyright (c) 1996-2005 Winbond Electronic Corporation
-//
-//  Module Name:
-//    wblinux.c
-//
-//  Abstract:
-//    Linux releated routines
-//
-//============================================================================
-#include <linux/netdevice.h>
-
-#include "mds_f.h"
-#include "mto_f.h"
-#include "os_common.h"
-#include "wbhal_f.h"
-#include "wblinux_f.h"
-
-void
-WBLINUX_stop(  struct wbsoft_priv * adapter )
-{
-	if (atomic_inc_return(&adapter->ThreadCount) == 1) {
-		// Shutdown module immediately
-		adapter->shutdown = 1;
-#ifdef _PE_STATE_DUMP_
-		WBDEBUG(( "[w35und] SKB_RELEASE OK\n" ));
-#endif
-	}
-
-	atomic_dec(&adapter->ThreadCount);
-}
--- a/drivers/staging/winbond/wblinux_f.h
+++ b/drivers/staging/winbond/wblinux_f.h
@@ -10,9 +10,7 @@
 // wblinux_f.h
 //
 int wb35_start_xmit(struct sk_buff *skb, struct net_device *netdev );
-void WBLINUX_stop(  struct wbsoft_priv *adapter );
 void wb35_set_multicast( struct net_device *netdev );
 struct net_device_stats * wb35_netdev_stats( struct net_device *netdev );
-void WBLINUX_stop(  struct wbsoft_priv *adapter );
 
 #endif
--- a/drivers/staging/winbond/wbusb.c
+++ b/drivers/staging/winbond/wbusb.c
@@ -302,8 +302,7 @@ error:
 	case 4:
 	case 3: Mds_Destroy( priv );
 	case 2:
-	case 1: WBLINUX_stop(priv);
-		hal_halt( pHwData, NULL );
+	case 1: hal_halt( pHwData, NULL );
 	case 0: break;
 	}
 
@@ -402,9 +401,6 @@ static void wb35_hw_halt(struct wbsoft_p
 #endif
 	msleep(100);// Waiting Irp completed
 
-	// Destroy the NDIS module
-	WBLINUX_stop(adapter);
-
 	// Halt the HAL
 	hal_halt(&adapter->sHwData, NULL);
 }

From sathyap@serverengines.com  Mon Nov 17 14:59:50 2008
From: Sathya Perla <sathyap@serverengines.com>
Date: Thu, 13 Nov 2008 11:13:32 +0530
Subject: Staging: benet: fix build errors when CONFIG_NETPOLL is off
To: greg@kroah.com
Cc: subbus@serverengines.com
Message-ID: <1226555012.6200.15.camel@sperla-laptop>


Signed-off-by: Sathya Perla <sathyap@serverengines.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/staging/benet/Kconfig  |    2 +-
 drivers/staging/benet/TODO     |    1 -
 drivers/staging/benet/be_int.c |    8 +++-----
 3 files changed, 4 insertions(+), 7 deletions(-)

--- a/drivers/staging/benet/be_int.c
+++ b/drivers/staging/benet/be_int.c
@@ -717,18 +717,16 @@ irqreturn_t be_int(int irq, void *dev)
  */
 int be_poll(struct napi_struct *napi, int budget)
 {
-	struct net_device *netdev = napi->dev;
-	struct be_net_object *pnob = (struct be_net_object *)netdev->priv;
-	struct be_adapter *adapter = pnob->adapter;
+	struct be_net_object *pnob = container_of(napi, struct be_net_object, napi);
 	u32 work_done;
 
-	adapter->be_stat.bes_polls++;
+	pnob->adapter->be_stat.bes_polls++;
 	work_done = process_rx_completions(pnob, budget);
 	BUG_ON(work_done > budget);
 
 	/* All consumed */
 	if (work_done < budget) {
-		netif_rx_complete(netdev, napi);
+		netif_rx_complete(pnob->netdev, napi);
 		/* enable intr */
 		be_notify_cmpl(pnob, work_done, pnob->rx_cq_id, 1);
 	} else {
--- a/drivers/staging/benet/Kconfig
+++ b/drivers/staging/benet/Kconfig
@@ -1,6 +1,6 @@
 config BENET
 	tristate "ServerEngines 10Gb NIC - BladeEngine"
-	depends on PCI && INET && NETPOLL
+	depends on PCI && INET
 	select INET_LRO
 	help
 	  This driver implements the NIC functionality for ServerEngines
--- a/drivers/staging/benet/TODO
+++ b/drivers/staging/benet/TODO
@@ -2,7 +2,6 @@ TODO:
 	- fix minor checkpatch.pl issues
 	- remove wrappers around common iowrite functions
 	- full netdev audit of common problems/issues
-	- fix build errors when CONFIG_NETPOLL is not enabled
 
 Please send all patches and questions to Subbu Seetharaman
 <subbus@serverengines.com> and Greg Kroah-Hartman <greg@kroah.com>

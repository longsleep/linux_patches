From 721083f2d30cb3791ec66ca97f05e40e8414b9e9 Mon Sep 17 00:00:00 2001
From: Ian Abbott <abbotti@mev.co.uk>
Date: Tue, 9 Dec 2008 11:07:22 +0000
Subject: Staging: comedi: Make comedi_auto_config() succeed when auto-configuration disabled.

Otherwise it would not work properly.

From: Ian Abbott <abbotti@mev.co.uk>
Cc: Frank Mori Hess <fmhess@users.sourceforge.net>
Cc: David Schleef <ds@schleef.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/staging/comedi/drivers.c |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

--- a/drivers/staging/comedi/drivers.c
+++ b/drivers/staging/comedi/drivers.c
@@ -799,8 +799,10 @@ int comedi_auto_config(struct device *ha
 	int retval;
 	unsigned *private_data = NULL;
 
-	if (!comedi_autoconfig)
-		return -ENODEV;
+	if (!comedi_autoconfig) {
+		dev_set_drvdata(hardware_device, NULL);
+		return 0;
+	}
 
 	minor = comedi_alloc_board_minor(hardware_device);
 	if(minor < 0) return minor;

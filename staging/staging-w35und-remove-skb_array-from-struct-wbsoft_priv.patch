From penberg@cs.helsinki.fi  Wed Nov 12 13:53:34 2008
From: Pekka Enberg <penberg@cs.helsinki.fi>
Date: Thu, 30 Oct 2008 18:12:06 +0200
Subject: Staging: w35und: remove ->skb_array from struct wbsoft_priv
To: greg@kroah.com
Cc: Pekka Enberg <penberg@cs.helsinki.fi>, Pavel Machek <pavel@suse.cz>
Message-ID: <1225383127-16406-6-git-send-email-penberg@cs.helsinki.fi>


It's not actually used for anything, so remove it.

Acked-by: Pavel Machek <pavel@suse.cz>
Signed-off-by: Pekka Enberg <penberg@cs.helsinki.fi>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/staging/winbond/core.h    |    3 ---
 drivers/staging/winbond/wblinux.c |   16 ----------------
 2 files changed, 19 deletions(-)

--- a/drivers/staging/winbond/core.h
+++ b/drivers/staging/winbond/core.h
@@ -31,10 +31,7 @@ struct wbsoft_priv {
 	u32 RxByteCount;
 	u32 TxByteCount;
 
-	struct sk_buff *skb_array[WBLINUX_PACKET_ARRAY_SIZE];
 	struct sk_buff *packet_return;
-	s32 skb_SetIndex;
-	s32 skb_GetIndex;
 	s32 netif_state_stop;	// 1: stop  0: normal
 	struct iw_statistics iw_stats;
 
--- a/drivers/staging/winbond/wblinux.c
+++ b/drivers/staging/winbond/wblinux.c
@@ -19,25 +19,9 @@
 void
 WBLINUX_stop(  struct wbsoft_priv * adapter )
 {
-	struct sk_buff *pSkb;
-
 	if (atomic_inc_return(&adapter->ThreadCount) == 1) {
 		// Shutdown module immediately
 		adapter->shutdown = 1;
-
-		while (adapter->skb_array[ adapter->skb_GetIndex ]) {
-			// Trying to free the un-sending packet
-			pSkb = adapter->skb_array[ adapter->skb_GetIndex ];
-			adapter->skb_array[ adapter->skb_GetIndex ] = NULL;
-			if( in_irq() )
-				dev_kfree_skb_irq( pSkb );
-			else
-				dev_kfree_skb( pSkb );
-
-			adapter->skb_GetIndex++;
-			adapter->skb_GetIndex %= WBLINUX_PACKET_ARRAY_SIZE;
-		}
-
 #ifdef _PE_STATE_DUMP_
 		WBDEBUG(( "[w35und] SKB_RELEASE OK\n" ));
 #endif

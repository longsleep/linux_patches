From alan@linux.intel.com  Mon Oct 26 14:56:57 2009
From: Alan Cox <alan@linux.intel.com>
Date: Tue, 06 Oct 2009 15:49:36 +0100
Subject: Staging: et131x: Clean up the tx ring init
To: greg@kroah.com
Message-ID: <20091006144934.8604.63090.stgit@localhost.localdomain>


Keep this small change separate for bisectability

Signed-off-by: Alan Cox <alan@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/staging/et131x/et1310_tx.c |   18 +++++++-----------
 1 file changed, 7 insertions(+), 11 deletions(-)

--- a/drivers/staging/et131x/et1310_tx.c
+++ b/drivers/staging/et131x/et1310_tx.c
@@ -282,23 +282,19 @@ void et131x_init_send(struct et131x_adap
 
 	tx_ring->TCBReadyQueueHead = tcb;
 
-	/* Go through and set up each TCB */
-	for (ct = 0; ct < NUM_TCB; ct++) {
-		memset(tcb, 0, sizeof(struct tcb));
+	memset(tcb, 0, sizeof(struct tcb) * NUM_TCB);
 
+	/* Go through and set up each TCB */
+	for (ct = 0; ct++ < NUM_TCB; tcb++) {
 		/* Set the link pointer in HW TCB to the next TCB in the
 		 * chain.  If this is the last TCB in the chain, also set the
 		 * tail pointer.
 		 */
-		if (ct < NUM_TCB - 1)
-			tcb->Next = tcb + 1;
-		else {
-			tx_ring->TCBReadyQueueTail = tcb;
-			tcb->Next = NULL;
-		}
+		tcb->Next = tcb + 1;
 
-		tcb++;
-	}
+	tcb--;
+	tx_ring->TCBReadyQueueTail = tcb;
+	tcb->Next = NULL;
 	/* Curr send queue should now be empty */
 	tx_ring->CurrSendHead = NULL;
 	tx_ring->CurrSendTail = NULL;

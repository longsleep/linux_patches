From alan@lxorguk.ukuu.org.uk  Wed Aug 12 13:22:22 2009
From: Alan Cox <alan@lxorguk.ukuu.org.uk>
Date: Fri, 07 Aug 2009 19:24:58 +0100
Subject: Staging: sep: load_rom is remarkably verbose and repetetive
To: greg@kroah.com, mark.a.allyn@intel.com
Message-ID: <20090807182456.19360.45526.stgit@localhost.localdomain>


From: Alan Cox <alan@linux.intel.com>

Give it a haircut

Signed-off-by: Alan Cox <alan@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
---

 drivers/staging/sep/sep_driver.c |   25 ++++++-------------------
 1 file changed, 6 insertions(+), 19 deletions(-)


--- a/drivers/staging/sep/sep_driver.c
+++ b/drivers/staging/sep/sep_driver.c
@@ -105,9 +105,9 @@ static void sep_load_rom_code(struct sep
 	sep_write_reg(sep, HW_HOST_SEP_SW_RST_REG_ADDR, 0x1);
 
 	/* poll for SEP ROM boot finish */
-	do {
+	do
 		reg = sep_read_reg(sep, HW_HOST_SEP_HOST_GPR3_REG_ADDR);
-	} while (!reg);
+	while (!reg);
 
 	edbg("SEP Driver: ROM polling ended\n");
 
@@ -117,31 +117,18 @@ static void sep_load_rom_code(struct sep
 		error = sep_read_reg(sep, HW_HOST_SEP_HOST_GPR0_REG_ADDR);
 		edbg("SEP Driver: ROM polling case 1\n");
 		break;
-	case 0x2:
-		/* Boot First Phase ended  */
-		warning = sep_read_reg(sep, HW_HOST_SEP_HOST_GPR0_REG_ADDR);
-		edbg("SEP Driver: ROM polling case 2\n");
-		break;
 	case 0x4:
 		/* Cold boot ended successfully  */
-		warning = sep_read_reg(sep, HW_HOST_SEP_HOST_GPR0_REG_ADDR);
-		edbg("SEP Driver: ROM polling case 4\n");
-		error = 0;
-		break;
 	case 0x8:
 		/* Warmboot ended successfully */
-		warning = sep_read_reg(sep, HW_HOST_SEP_HOST_GPR0_REG_ADDR);
-		edbg("SEP Driver: ROM polling case 8\n");
-		error = 0;
-		break;
 	case 0x10:
 		/* ColdWarm boot ended successfully */
-		warning = sep_read_reg(sep, HW_HOST_SEP_HOST_GPR0_REG_ADDR);
-		edbg("SEP Driver: ROM polling case 16\n");
 		error = 0;
-		break;
+	case 0x2:
+		/* Boot First Phase ended  */
+		warning = sep_read_reg(sep, HW_HOST_SEP_HOST_GPR0_REG_ADDR);
 	case 0x20:
-		edbg("SEP Driver: ROM polling case 32\n");
+		edbg("SEP Driver: ROM polling case %d\n", reg);
 		break;
 	}
 

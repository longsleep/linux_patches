From martyn.welch@gefanuc.com  Thu Oct 29 16:14:37 2009
From: Martyn Welch <martyn.welch@gefanuc.com>
Date: Thu, 29 Oct 2009 16:35:27 +0000
Subject: staging: vme: Fix mutex locking
To: gregkh@suse.de
Cc: devel@linuxdriverproject.org
Message-ID: <20091029163527.18368.65701.stgit@ES-J7S4D2J.amer.consind.ge.com>


Fix incorrect use of mutex_trylock().

Signed-off-by: Martyn Welch <martyn.welch@gefanuc.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/staging/vme/vme.c |    6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

--- a/drivers/staging/vme/vme.c
+++ b/drivers/staging/vme/vme.c
@@ -879,7 +879,7 @@ int vme_dma_list_add(struct vme_dma_list
 		return -EINVAL;
 	}
 
-	if (mutex_trylock(&(list->mtx))) {
+	if (!mutex_trylock(&(list->mtx))) {
 		printk("Link List already submitted\n");
 		return -EINVAL;
 	}
@@ -922,7 +922,7 @@ int vme_dma_list_free(struct vme_dma_lis
 		return -EINVAL;
 	}
 
-	if (mutex_trylock(&(list->mtx))) {
+	if (!mutex_trylock(&(list->mtx))) {
 		printk("Link List in use\n");
 		return -EINVAL;
 	}
@@ -955,7 +955,7 @@ int vme_dma_free(struct vme_resource *re
 
 	ctrlr = list_entry(resource->entry, struct vme_dma_resource, list);
 
-	if (mutex_trylock(&(ctrlr->mtx))) {
+	if (!mutex_trylock(&(ctrlr->mtx))) {
 		printk("Resource busy, can't free\n");
 		return -EBUSY;
 	}

From albcamus@gmail.com  Wed Jul 21 13:07:03 2010
From: Jike Song <albcamus@gmail.com>
To: gregkh@suse.de
Cc: linux-kernel@vger.kernel.org, huangweibing@gmail.com,
	Jike Song <albcamus@gmail.com>
Subject: driver core: fix memory leak one one error path in bus_register()
Date: Thu, 15 Jul 2010 17:43:54 +0800
Message-Id: <1279187034-11826-1-git-send-email-albcamus@gmail.com>

Reported-by: huangweibing@gmail.com
Signed-off-by: Jike Song <albcamus@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/base/bus.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/base/bus.c
+++ b/drivers/base/bus.c
@@ -945,8 +945,8 @@ bus_devices_fail:
 	bus_remove_file(bus, &bus_attr_uevent);
 bus_uevent_fail:
 	kset_unregister(&bus->p->subsys);
-	kfree(bus->p);
 out:
+	kfree(bus->p);
 	bus->p = NULL;
 	return retval;
 }

From akpm@linux-foundation.org  Fri Aug  7 16:54:44 2009
From: Andrew Morton <akpm@linux-foundation.org>
Date: Thu, 06 Aug 2009 16:00:44 -0700
Subject: driver core: platform_device_add_data(): use kmemdup()
To: greg@kroah.com
Cc: akpm@linux-foundation.org
Message-ID: <200908062300.n76N0juB029125@imap1.linux-foundation.org>


From: Andrew Morton <akpm@linux-foundation.org>

Instead of open-coding it.

Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
---

 drivers/base/platform.c |    8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

--- a/drivers/base/platform.c
+++ b/drivers/base/platform.c
@@ -10,6 +10,7 @@
  * information.
  */
 
+#include <linux/string.h>
 #include <linux/platform_device.h>
 #include <linux/module.h>
 #include <linux/init.h>
@@ -212,14 +213,13 @@ EXPORT_SYMBOL_GPL(platform_device_add_re
 int platform_device_add_data(struct platform_device *pdev, const void *data,
 			     size_t size)
 {
-	void *d;
+	void *d = kmemdup(data, size, GFP_KERNEL);
 
-	d = kmalloc(size, GFP_KERNEL);
 	if (d) {
-		memcpy(d, data, size);
 		pdev->dev.platform_data = d;
+		return 0;
 	}
-	return d ? 0 : -ENOMEM;
+	return -ENOMEM;
 }
 EXPORT_SYMBOL_GPL(platform_device_add_data);
 

From kernel-bounces+gregkh=suse.de@suse.de Tue Feb  9 08:22:58 2010
From: Richard Guenther <rguenther@suse.de>
Date: Tue, 9 Feb 2010 17:22:55 +0100 (CET)
Subject: dvb: l64781.ko broken with gcc 4.5
Cc: Andreas Gruenbacher <agruen@suse.de>
Message-ID: <alpine.LNX.2.00.1002091719550.29631@zhemvz.fhfr.qr>

I'm trying to fix it on the GCC side (PR43007), but the module is
quite stupid in using ULL constants to operate on u32 values:

static int apply_frontend_param (struct dvb_frontend* fe, struct
dvb_frontend_parameters *param)
{
...
 static const u32 ppm = 8000;
 u32 spi_bias;
...

 spi_bias *= 1000ULL;
 spi_bias /= 1000ULL + ppm/1000;


which causes current GCC 4.5 to emit calls to __udivdi3 for i?86 again.

This patch fixes this issue.

Signed-off-by: Richard Guenther <rguenther@suse.de>
Cc: Andreas Gruenbacher <agruen@suse.de>
Cc: stable <stable@kernel.org>
Cc: Mauro Carvalho Chehab <mchehab@infradead.org>
Cc: Matthias Schwarzott <zzam@gentoo.org>
Cc: Douglas Schilling Landgraf <dougsland@redhat.com>
Cc: Andreas Oberritter <obi@linuxtv.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/media/dvb/frontends/l64781.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/media/dvb/frontends/l64781.c
+++ b/drivers/media/dvb/frontends/l64781.c
@@ -192,8 +192,8 @@ static int apply_frontend_param (struct
 	spi_bias *= qam_tab[p->constellation];
 	spi_bias /= p->code_rate_HP + 1;
 	spi_bias /= (guard_tab[p->guard_interval] + 32);
-	spi_bias *= 1000ULL;
-	spi_bias /= 1000ULL + ppm/1000;
+	spi_bias *= 1000;
+	spi_bias /= 1000 + ppm/1000;
 	spi_bias *= p->code_rate_HP;
 
 	val0x04 = (p->transmission_mode << 2) | p->guard_interval;

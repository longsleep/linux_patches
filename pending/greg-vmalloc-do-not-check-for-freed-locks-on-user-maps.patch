From tglx@linutronix.de  Wed Mar  5 11:42:42 2008
From: Thomas Gleixner <tglx@linutronix.de>
Date: Wed, 05 Mar 2008 16:03:42 -0000
Subject: greg: vmalloc: do not check for freed locks on user maps
Cc: Andrew Morton <akpm@linux-foundation.org>, Greg KH <greg@kroah.com>, Peter Zijlstra <peterz@infradead.org>, Ingo Molnar <mingo@elte.hu>
Message-ID: <20080305155117.447021903@linutronix.de>


User maps do not contain kernel internal objects. No need to check
them.

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Acked-by: Ingo Molnar <mingo@elte.hu>

---
 mm/vmalloc.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/mm/vmalloc.c
+++ b/mm/vmalloc.c
@@ -382,7 +382,8 @@ static void __vunmap(const void *addr, i
 		return;
 	}
 
-	debug_check_no_locks_freed(addr, area->size);
+	if (!(area->flags & VM_USERMAP))
+		debug_check_no_locks_freed(addr, area->size);
 
 	if (deallocate_pages) {
 		int i;
